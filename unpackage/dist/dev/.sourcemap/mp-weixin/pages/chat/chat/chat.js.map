{"version":3,"sources":["uni-app:///main.js","webpack:////Users/jhq/WeChatProjects/weixinApp/pages/chat/chat/chat.nvue?f11a","webpack:////Users/jhq/WeChatProjects/weixinApp/pages/chat/chat/chat.nvue?4704","webpack:////Users/jhq/WeChatProjects/weixinApp/pages/chat/chat/chat.nvue?9403","webpack:////Users/jhq/WeChatProjects/weixinApp/pages/chat/chat/chat.nvue?258a","uni-app:///pages/chat/chat/chat.nvue","webpack:////Users/jhq/WeChatProjects/weixinApp/pages/chat/chat/chat.nvue?9063","webpack:////Users/jhq/WeChatProjects/weixinApp/pages/chat/chat/chat.nvue?bee7"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,+F,6FAFmBA,EAAE,CAACC,iCAAH,GAAuCC,mBAAvC;AAGnBC,UAAU,CAACC,aAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkH;AAClH;AACyD;AACL;AACa;;;AAGjE;AACgN;AAChN,gBAAgB,iNAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,gFAAM;AACR,EAAE,yFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAm0B,CAAgB,myBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC8Jv1B;;;;;AAKA;AACA;AACA,mG;;;;;;;AAOA;AACA,yBADA;AAEA;AACA,0BADA;AAEA,kCAFA;AAGA,8BAHA;AAIA,wBAJA;AAKA,kCALA,EAFA;;AASA,MATA,kBASA;AACA;AACA,wBADA;AAEA;AACA;AACA,wBAJA;AAKA;AACA,qBANA;AAOA;AACA,wBARA;;AAUA;AACA,kBAXA;AAYA;AACA,cAbA;AAcA;AACA,uBAfA;AAgBA;AACA,mBAjBA;AAkBA,qBAlBA;AAmBA,wBAnBA;;AAqBA,mBArBA;AAsBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAhCA;AAiCA;AACA;AACA,kBADA;AAEA,8CAFA;AAGA,4BAHA;;AAKA;AACA,kBADA;AAEA,gDAFA;AAGA,4BAHA,EALA;;AAUA;AACA,oBADA;AAEA,gDAFA;AAGA,iBAHA,EAVA;;AAeA;AACA,kBADA;AAEA,+CAFA;AAGA,iBAHA,EAfA;;AAoBA;AACA,kBADA;AAEA,gDAFA;AAGA,iBAHA,EApBA;;AAyBA;AACA,kBADA;AAEA,kDAFA;AAGA,yBAHA,EAzBA;;AA8BA;AACA,kBADA;AAEA,8CAFA;AAGA,yBAHA,EA9BA,CADA,CAjCA;;;;AAuEA,sBAvEA;AAwEA;AACA,aADA;AAEA,gBAFA;AAGA,kBAHA;AAIA,yBAJA,EAxEA;;AA8EA,oBA9EA;;;AAiFA,GA3FA;;AA6FA,QA7FA,kBA6FA,CA7FA,EA6FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GA9GA;;AAgHA,WAhHA,uBAgHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAvHA;AAwHA,SAxHA,qBAwHA;AACA;;;;AAIA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,KAVA;;AAYA;AACA;AACA;AACA;AACA;AACA;AACA,KANA;AAOA;AACA;AACA;AACA,gCADA;;AAGA;AACA,KANA;AAOA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAjLA;AAkLA;AACA,QADA,gBACA,MADA,EACA,MADA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA,GAlLA;;AAkMA;AACA,gDADA;AAEA,cAFA,sBAEA,CAFA,EAEA;AACA;AACA;AACA;AACA;AACA;AACA,KARA;AASA,iBATA,2BASA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA,KAfA;AAgBA,aAhBA,qBAgBA,OAhBA,EAgBA;AACA;AACA;AACA,aADA,IACA,gCADA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAhCA;AAiCA;AACA,eAlCA,yBAkCA;AACA;AACA;AACA,4BADA;AAEA,0CAFA,GADA;;;AAMA,KAzCA;AA0CA;AACA,mBA3CA,2BA2CA,CA3CA,EA2CA;AACA;AACA;AACA;AACA;AACA;AACA,qBADA;;AAGA,KAnDA;AAoDA,iBApDA,2BAoDA;AACA;;AAEA;AACA;AACA,KAzDA;AA0DA;AACA,oBA3DA,8BA2DA;AACA;AACA;AACA;AACA;AACA,KAhEA;AAiEA;AACA,kBAlEA,0BAkEA,CAlEA,EAkEA;AACA;AACA;;AAEA,KAtEA;AAuEA;AACA,qBAxEA,+BAwEA;AACA;AACA;AACA;AACA;;AAEA,KA9EA;AA+EA,gBA/EA,wBA+EA,GA/EA,EA+EA;AACA;AACA,oBADA;AAEA,4BAFA;;AAIA,KApFA;AAqFA,UArFA,oBAqFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BADA;AAEA,+DAFA;AAGA,kCAHA;;AAKA;AACA;AACA;AACA;AACA;AACA,wCADA;AAEA,6BAFA;AAGA,iCAHA;AAIA,qCAJA;AAKA,oFALA;;AAOA,KAjHA;AAkHA,aAlHA,uBAkHA;;AAEA;AACA,KArHA;;AAuHA;AACA,wBAxHA,gCAwHA,IAxHA,EAwHA;AACA;AACA;AACA;AACA;AACA,KA7HA;AA8HA;AACA,QA/HA,gBA+HA,IA/HA,EA+HA;;AAEA;AACA;AACA;AACA;AACA,gBAHA;;AAKA;AACA,kBADA;AAEA,kBAFA;AAGA,wBAHA;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YADA,IACA,4CADA,EACA;AACA;AACA;AACA,SAFA;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OANA,EAMA,KANA,CAMA;AACA;AACA;AACA;AACA,OAVA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA,KAjLA;AAkLA;AACA,QAnLA;;;;AAuLA,SAHA,CAGA,QAHA,CAGA,CAFA,CAEA,QAFA,CAEA,CADA,KACA,QADA,KACA;AACA;AACA;AACA;AACA;AACA,qBADA;AAEA,+BAFA;;AAIA;AACA,kBADA;AAEA,qBAFA,EAJA;;AAQA;AACA,kBADA;AAEA,uBAFA;;AAIA;AACA;AACA;AACA;AAfA;;AAkBA;AACA;AACA;AACA;;AAEA,oBAFA;AAGA,iCAHA;;AAKA;;AAEA;AACA;AACA,oBADA;AAEA,uBAFA;;AAIA;;AAEA;AACA;AACA;AACA,KAjOA;AAkOA;AACA,cAnOA,sBAmOA,KAnOA,EAmOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAFA;;AAIA;AACA;AACA;AACA,4FADA;;AAGA;AACA;AACA;AACA,2BADA;AAEA;AACA;AACA,6BADA;AAEA,4BAFA;AAGA,kCAHA;;AAKA,aARA;;AAUA;AACA;AACA;AACA,4BADA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sCADA;AAEA,oDAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAFA,MAEA;AACA;AACA;AACA;AACA;AACA,iBAfA;AAgBA;;AAEA,aA5BA;;AA8BA;AACA;;AAEA;AACA,8BADA;AAEA;AACA;AACA;AACA,iCADA;AAEA,iCAFA;AAGA,uDAHA;AAIA,oBAJA,CAIA;AACA;AACA,mCADA;AAEA,gCAFA;;AAIA,iBATA;AAUA;AACA,aAfA;;AAiBA,gBA5EA;;AA8EA;AACA,KArTA;AAsTA;;AAEA,gBAxTA,0BAwTA;AACA;;;;;;;;;;;;AAYA;AACA;;AAEA,OAfA,EAeA,GAfA;;AAiBA,KA1UA;AA2UA;AACA,eA5UA,uBA4UA,CA5UA,EA4UA;AACA;AACA;AACA;AACA;AACA,oBADA;AAEA,iCAFA;AAGA;AACA;AACA;AACA;AACA;AACA,eAFA;AAGA,aATA;;AAWA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,aANA;;AAQA;AACA;AACA;AACA,+CADA;;AAGA;AACA;AACA;AACA,6DADA;;AAGA,gBAxCA;;;AA2CA;AACA,KAzXA;AA0XA,SA1XA,iBA0XA,CA1XA,EA0XA;AACA;AACA;AACA;AACA;AACA,KA/XA;AAgYA,QAhYA,gBAgYA,CAhYA,EAgYA;AACA;AACA;AACA,KAnYA,GAlMA;;;;AAykBA;AACA;AACA,sFADA;AAEA,oEAFA;AAGA,+DAHA;AAIA,2EAJA;AAKA,wDALA;AAMA;AACA;AAPA,IADA;AAUA;AACA,mBAXA,6BAWA;AACA;AACA,iBADA;AAEA;AACA;AACA;AACA;AACA,KAlBA;AAmBA;AACA,aApBA,uBAoBA;AACA;AACA;AACA;AACA;AACA;AACA,OAJA;AAKA;AACA,KA5BA;AA6BA;AACA,kBA9BA,4BA8BA;AACA;AACA;AACA,KAjCA;AAkCA;AACA,iBAnCA,2BAmCA;AACA;AACA,KArCA;AAsCA;AACA,YAvCA,sBAuCA;AACA;AACA;AACA;AACA,KA3CA;AA4CA;AACA,kBA7CA,4BA6CA;AACA;AACA;AACA;AACA;AACA;AACA,KAnDA;AAoDA;AACA,cArDA,wBAqDA;AACA;AACA;AACA;AACA;AACA;AACA,KA3DA;AA4DA;AACA,wBA7DA,kCA6DA;AACA;;AAEA,KAhEA,GAzkBA,E;;;;;;;;;;;;;AC5KA;AAAA;AAAA;AAAA;AAAgrC,CAAgB,gmCAAG,EAAC,C;;;;;;;;;;;ACApsC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/chat/chat/chat.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/chat/chat/chat.nvue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.nvue?vue&type=template&id=411c1acd&\"\nvar renderjs\nimport script from \"./chat.nvue?vue&type=script&lang=js&\"\nexport * from \"./chat.nvue?vue&type=script&lang=js&\"\nimport style0 from \"./chat.nvue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chat/chat/chat.nvue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=template&id=411c1acd&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=script&lang=js&\"","<style>\n  view,\n  label,\n  swiper-item,\n  scroll-view {\n    display:flex;\n    flex-direction:column;\n    flex-shrink: 0;\n    flex-grow: 0;\n    flex-basis: auto;\n    align-items: stretch;\n    align-content: flex-start;\n  }\n  view,\n  image,\n  input,\n  scroll-view,\n  swiper,\n  swiper-item,\n  text,\n  textarea,\n  video {\n    position: relative;\n    border: 0px solid #000000;\n    box-sizing: border-box;\n  }\n  swiper-item {\n    position: absolute;\n  }\n  button {\n    margin: 0;\n  }\n</style>\n<template>\r\n\t<view class=\"page\">\r\n\r\n\t\t<!-- 导航栏 -->\r\n\t\t<free-nav-bar showBack :title=\"detail.name\" :noreadnum=\"0\">\r\n\t\t\t<view slot=\"right\">\r\n\t\t\t\t<free-icon-button @click='openChatSet' :icon=\"'\\ue612'\"></free-icon-button>\r\n\t\t\t</view>\r\n\r\n\t\t</free-nav-bar>\r\n\r\n\t\t<!-- 聊天内容 -->\r\n\t\t<scroll-view  @click=\"clickPage\" scroll-y :style=\"chatBodyBottom\"\r\n\t\t\tstyle=\"box-sizing: border-box;\" class=\"position-fixed left-0 right-0\" :scroll-into-view=\"scrollintoView\">\r\n\t\t\t<!-- 聊天信息列表 -->\r\n\t\t\t<view :id=\"'chatItem_'+index\" v-for=\"(item,index) in list\" :key='index'>\r\n\t\t\t\t<free-chat-item ref='chatItem' :shownickname=\"currentChatItem.shownickname\" @preview='previewImage'\r\n\t\t\t\t\t@long='long' :pretime=\"index>0?list[index-1].create_time:''\" :item=\"item\" :index=\"index\">\r\n\t\t\t\t</free-chat-item>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"p-1\">\r\n\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\t\t<!-- #ifdef APP-PLUS-NVUE -->\r\n\t\t<div v-if=\"mode==='action'||mode==='emoticon'\" :style=\"'bottom:'+MaskBottom+'px;'\"\r\n\t\t\tclass=\"position-fixed top-0 bottom-0 left-0 right-0\" @click=\"clickPage\"></div>\r\n\r\n\t\t<!-- #endif -->\r\n\t\t<!-- 底部输入框 -->\r\n\t\t<view class=\"position-fixed bg-chat left-0 right-0 border-light-secondary border-top\"\r\n\t\t\t:style=\"'bottom:'+KeyboardHeight+'px;'\">\r\n\t\t\t<view style=\" width: 100vw; height: 105rpx;\" class=\"flex align-center\">\r\n\t\t\t\t<view class=\"flex-shrink\">\r\n\t\t\t\t\t<free-icon-button v-if=\"mode==='audio'\" @click='changeVoiceOrText' iconfontSize='font-max'\r\n\t\t\t\t\t\t:icon=\"`\\ue605`\"></free-icon-button>\r\n\t\t\t\t\t<free-icon-button v-else @click='changeVoiceOrText' iconfontSize='font-max' :icon=\"`\\ue606`\">\r\n\t\t\t\t\t</free-icon-button>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"flex-1\">\r\n\t\t\t\t\t<view @touchstart=\"voiceTouchStart\" @touchend=\"voiceTouchEnd\" @touchcancel=\"voiceTouchCancel\"\r\n\t\t\t\t\t\t@touchmove=\"voiceTouchMove\" :class=\"isRecording?'bg-light':'bg-white'\" v-if=\"mode==='audio'\"\r\n\t\t\t\t\t\tclass=\"rounded flex align-center justify-center\" style=\"height: 75rpx;\">\r\n\t\t\t\t\t\t<text class=\"font\">{{isRecording?`松开 结束`:`按住 说话`}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<textarea v-else v-model=\"text\" @focus=\"focus\" @blur=\"blur\" :adjust-position=\"false\" fixed\r\n\t\t\t\t\t\tclass=\"bg-white rounded mr-0 p-1 font-md\" style=\"width: auto; height: 75rpx;\" />\r\n\t\t\t\t</view>\r\n\t\t\t\t<!-- 表情 -->\r\n\t\t\t\t<view class=\"flex-shrink\">\r\n\t\t\t\t\t<free-icon-button iconfontSize='font-max' @click=\"openActionOrEmoticon('emoticon')\"\r\n\t\t\t\t\t\t:icon=\"'\\ue61d'\">\r\n\t\t\t\t\t</free-icon-button>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"flex-shrink\" v-if=\"text.length===0\">\r\n\t\t\t\t\t<!-- 扩展菜单按钮 -->\r\n\t\t\t\t\t<free-icon-button iconfontSize='font-max' @click=\"openActionOrEmoticon('action')\" :icon=\"'\\ue60a'\">\r\n\t\t\t\t\t</free-icon-button>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view v-else class=\"flex-shrink\">\r\n\t\t\t\t\t<!-- 发送按钮 -->\r\n\t\t\t\t\t<free-main-button @click='send(\"text\")' name=\"发送\"></free-main-button>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\n\t\t\t\n\t\t\t\r\n\t\t\t<view v-if=\"mode==='emoticon'||mode==='action'\" style=\"height: 650rpx;background-color:#f7f7f7;\" class=\"border-top  border-light-secondary\">\r\n\t\t\t\t<swiper :indicator-dots=\"emoticonOrActionList.length>1\" style=\"height: 630rpx;\">\r\n\t\t\t\t\t<swiper-item class=\"row\" v-for=\"(item,index) in emoticonOrActionList\" :key='index'>\r\n\t\t\t\t\t\t<view @click=\"actionEvent(item2)\" v-for=\"(item2,index2) in item\" :key='index2'\r\n\t\t\t\t\t\t\tstyle=\"height: 255rpx;\" class=\"flex flex-column justify-center align-center col-3\">\r\n\t\t\t\t\t\t\t<image :src=\"item2.icon\" mode=\"widthFix\" style=\"width: 100rpx;height: 100rpx;\"></image>\r\n\t\t\t\t\t\t\t<text class=\"font-sm text-light-muted mt-2\">{{item2.name}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</swiper-item>\r\n\r\n\t\t\t\t</swiper>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 扩展菜单 -->\r\n\t\t<!-- <free-popup :mask=\"false\" @hide='KeyboardHeight=0' fixedBottom transformOrigin='center bottom' ref='action'>\r\n\t\t\t<view style=\"height: 650rpx;background-color:#f7f7f7;\" class=\"border-top  border-light-secondary\">\r\n\t\t\t\t<swiper :indicator-dots=\"emoticonOrActionList.length>1\" style=\"height: 510rpx;\">\r\n\t\t\t\t\t<swiper-item class=\"row\" v-for=\"(item,index) in emoticonOrActionList\" :key='index'>\r\n\t\t\t\t\t\t<view @click=\"actionEvent(item2)\" v-for=\"(item2,index2) in item\" :key='index2'\r\n\t\t\t\t\t\t\tstyle=\"height: 255rpx;\" class=\"flex flex-column justify-center align-center col-3\">\r\n\t\t\t\t\t\t\t<image :src=\"item2.icon\" mode=\"widthFix\" style=\"width: 100rpx;height: 100rpx;\"></image>\r\n\t\t\t\t\t\t\t<text class=\"font-sm text-light-muted mt-2\">{{item2.name}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</swiper-item>\r\n\r\n\t\t\t\t</swiper>\r\n\t\t\t</view>\r\n\t\t</free-popup> -->\r\n\r\n\t\t<!-- 弹出层 -->\r\n\t\t<free-popup ref=\"extend\" :tabbarHeight='105' :bodyWidth=\"240\" :bodyHeight=\"500\">\r\n\t\t\t<view class=\"flex flex-column\" style=\"width:240rpx;\" :style=\"getMenusStyle\">\r\n\t\t\t\t<view @click=\"clickEvent(item.event)\" v-for=\"(item,index) in menusList\" :key=\"index\"\r\n\t\t\t\t\tclass=\"flex-1 flex align-center\" hover-stay-time='50' hover-start-time='0' hover-class=\"bg-hover-light\">\r\n\t\t\t\t\t<text class=\"font-md  pl-3\">{{item.name}}</text>\r\n\t\t\t\t</view>\r\n\r\n\t\t\t</view>\r\n\t\t</free-popup>\r\n\r\n\r\n\t\t<!-- 录音提示 -->\r\n\t\t<view v-if=\"isRecording\" class=\"position-fixed top-0 left-0 right-0 flex justify-center align-center\"\r\n\t\t\tstyle=\"bottom: 105rpx;\">\r\n\t\t\t<view class=\"rounded-2 flex flex-column align-center justify-center\"\r\n\t\t\t\tstyle=\"width: 360rpx;height: 360rpx;background-color: rgba(0,0,0,0.5);\">\r\n\t\t\t\t<image src=\"/static/audio/recording.gif\" style=\"width: 150rpx;height: 150rpx;\"></image>\r\n\t\t\t\t<text class=\"font text-white\">{{unRecord?'松开手指，取消发送':'手指上滑，取消发送'}}</text>\r\n\t\t\t\t<text class=\"font-md text-white mt-3\">{{RecordTime}}s</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\t// #ifdef APP-PLUS-NVUE\r\n\tconst dom = weex.requireModule('dom')\r\n\t// #endif\r\n\timport {\r\n\t\tmapState,\r\n\t\tmapMutations\r\n\t} from \"vuex\"\n\t\r\n\timport auth from \"@/common/mixin/auth.js\"\r\n\timport $U from \"@/common/free-lib/util.js\"\r\n\timport $H from \"@/common/free-lib/request.js\"\n\t\r\n\timport freeMainButton from \"@/components/free-ui/free-main-button.vue\"\r\n\timport freePopup from \"@/components/free-ui/free-popup.vue\"\r\n\timport freeChatItem from \"@/components/free-ui/free-chat-item.vue\"\r\n\timport freeIconButton from \"@/components/free-ui/free-icon-button.vue\"\r\n\timport freeNavBar from \"@/components/free-ui/free-nav-bar.vue\"\r\n\texport default {\r\n\t\tmixins: [auth],\r\n\t\tcomponents: {\r\n\t\t\tfreeNavBar,\r\n\t\t\tfreeIconButton,\r\n\t\t\tfreeChatItem,\r\n\t\t\tfreePopup,\r\n\t\t\tfreeMainButton\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tscrollintoView: '',\r\n\t\t\t\t// 录音\r\n\t\t\t\t// 手指Y轴\r\n\t\t\t\tRecordingStartY: 0,\r\n\t\t\t\t// 是否取消录音\r\n\t\t\t\tunRecord: false,\r\n\t\t\t\t// 音频录制状态\r\n\t\t\t\tisRecording: false,\r\n\r\n\t\t\t\t// 模式\r\n\t\t\t\tmode: \"text\",\r\n\t\t\t\t// 输入文字\r\n\t\t\t\ttext: '',\r\n\t\t\t\t// 键盘高度\r\n\t\t\t\tKeyboardHeight: 0,\r\n\t\t\t\t// 气泡索引\r\n\t\t\t\tpropIndex: -1,\r\n\t\t\t\tnavBarHeight: 0,\r\n\t\t\t\tstatusBarHeight: 0,\r\n\r\n\t\t\t\tmenusList: [],\r\n\t\t\t\t// list: [{\r\n\t\t\t\t// \t\tavatar: \"/static/images/demo/demo6.jpg\",\r\n\t\t\t\t// \t\tuser_id: 1,\r\n\t\t\t\t// \t\tnickname: '昵称',\r\n\t\t\t\t// \t\ttype: 'text',\r\n\t\t\t\t// \t\tdata: 'hollowaddd阿达达萨达收到阿达ddddddddddddddddadadad',\r\n\t\t\t\t// \t\tcreate_time: 1651900088,\r\n\t\t\t\t// \t\tisremove: false\r\n\t\t\t\t// \t},\r\n\t\t\t\t// 扩展菜单列表\r\n\t\t\t\tlist: [],\r\n\t\t\t\tactionList: [\r\n\t\t\t\t\t[{\r\n\t\t\t\t\t\t\tname: \"相册\",\r\n\t\t\t\t\t\t\ticon: \"/static/images/extends/pic.png\",\r\n\t\t\t\t\t\t\tevent: \"uploadImage\",\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: \"拍摄\",\r\n\t\t\t\t\t\t\ticon: \"/static/images/extends/video.png\",\r\n\t\t\t\t\t\t\tevent: \"uploadVideo\",\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: \"语音通话\",\r\n\t\t\t\t\t\t\ticon: \"/static/images/extends/phone.png\",\r\n\t\t\t\t\t\t\tevent: \"\",\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: \"位置\",\r\n\t\t\t\t\t\t\ticon: \"/static/images/extends/path.png\",\r\n\t\t\t\t\t\t\tevent: \"\",\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: \"音频\",\r\n\t\t\t\t\t\t\ticon: \"/static/images/extends/audio.png\",\r\n\t\t\t\t\t\t\tevent: \"\",\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: \"收藏\",\r\n\t\t\t\t\t\t\ticon: \"/static/images/extends/shoucan.png\",\r\n\t\t\t\t\t\t\tevent: \"openFava\",\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: \"名片\",\r\n\t\t\t\t\t\t\ticon: \"/static/images/extends/man.png\",\r\n\t\t\t\t\t\t\tevent: \"sendCard\",\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t],\r\n\t\t\t\temoticonList: [],\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tid: 0,\r\n\t\t\t\t\tname: \"\",\r\n\t\t\t\t\tavatar: \"\",\r\n\t\t\t\t\tchat_type: 'user'\r\n\t\t\t\t},\n\t\t\t\tisfocus:false\r\n\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonLoad(e) {\r\n\t\t\tif (!e.params) {\r\n\t\t\t\treturn this.backToast()\r\n\t\t\t}\r\n\t\t\tthis.detail = JSON.parse(decodeURIComponent(e.params))\r\n\t\t\t// 初始化\r\n\t\t\tthis.__init()\r\n\t\t\t// 创建聊天对象\r\n\t\t\tthis.chat.createChatObject(this.detail)\r\n\t\t\t// 获取历史记录\r\n\t\t\tthis.list = this.chat.getChatDetail()\r\n\t\t\t// 监听接受聊天信息\r\n\t\t\tuni.$on('onMessage', this.onMessage)\r\n\t\t\t// 监听清除聊天记录\r\n\t\t\tuni.$on('updateHistory', this.updateHistory)\r\n\t\t\t// 监听发送收藏和名片\r\n\t\t\tuni.$on('sendItem', this.onSendItem)\r\n\t\t},\r\n\r\n\t\tdestroyed() {\r\n\t\t\t// 销毁聊天对象\r\n\t\t\tthis.chat.destoryChatObject()\r\n\t\t\t// 销毁监听接受聊天消息\r\n\t\t\tuni.$off('onMessage', this.onMessage)\r\n\t\t\tuni.$off('updateHistory', this.updateHistory)\r\n\t\t\tuni.$off('sendItem', this.onSendItem)\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tvar statusBarHeight = 0\r\n\t\t\t// #ifdef APP-PLUS-NVUE\r\n\t\t\tstatusBarHeight = plus.navigator.getStatusbarHeight()\r\n\t\t\t// #endif\r\n\t\t\tthis.navBarHeight = statusBarHeight + uni.upx2px(90)\r\n\t\t\t// 监听键盘高度\r\n\t\t\tuni.onKeyboardHeightChange(res => {\r\n\t\t\t\tif (this.mode !== 'action' && this.mode !== 'emoticon') {\r\n\r\n\t\t\t\t\t// console.log(this.KeyboardHeight)\r\n\t\t\t\t\tthis.KeyboardHeight = res.height\r\n\t\t\t\t}\r\n\t\t\t\tif (this.KeyboardHeight > 0) {\r\n\t\t\t\t\tthis.pageToBottom()\r\n\t\t\t\t}\r\n\r\n\t\t\t})\r\n\r\n\t\t\tthis.$watch('list', (newVal, oldVal) => {\r\n\t\t\t\tif (newVal) {\r\n\t\t\t\t\tif (this.KeyboardHeight > 0) {\r\n\t\t\t\t\t\tthis.pageToBottom()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tthis.regSendVoiceEvent((url) => {\r\n\t\t\t\tif (!this.unRecord) {\r\n\t\t\t\t\tthis.send('audio', url, {\r\n\t\t\t\t\t\ttime: this.RecordTime\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tthis.pageToBottom()\r\n\t\t\t// 注册发送音频事件\r\n\r\n\t\t\t// 录音开始\r\n\t\t\t// RECORD.onStart(() => {\r\n\t\t\t// \tthis.RecordTime = 0\r\n\t\t\t// \tthis.RECORDTIMER = setInterval(() => {\r\n\t\t\t// \t\tthis.RecordTime++\r\n\t\t\t// \t}, 1000)\r\n\r\n\t\t\t// }),\r\n\r\n\t\t\t// // 监听录音结束\r\n\t\t\t// RECORD.onStop((e) => {\r\n\t\t\t// \tif (this.RECORDTIMER) {\r\n\t\t\t// \t\tclearInterval(this.RECORDTIMER)\r\n\t\t\t// \t\tthis.RECORDTIMER = null\r\n\t\t\t// \t}\r\n\t\t\t// \tif (!this.unRecord) {\r\n\t\t\t// \t\tthis.send('audio', e.tempFilePath, {\r\n\t\t\t// \t\t\ttime: this.RecordTime\r\n\t\t\t// \t\t})\r\n\t\t\t// \t}\r\n\t\t\t// })\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tmode(newVal, oldVal) {\n\t\t\t\tif (newVal !== 'text') {\n\t\t\t\t\tthis.isfocus=false\n\t\t\t\t\tthis.KeyboardHeight=0\n\t\t\t\t\tuni.hideKeyboard()\r\n\t\t\t\t}\r\n\t\t\t},\n\t\t\t// KeyboardH(newValue, oldValue){\n\t\t\t// \tthis.KeyboardHeight = newValue\n\t\t\t// \tif(newValue > 0){\n\t\t\t// \t\tthis.mode = 'text'\n\t\t\t// \t}\n\t\t\t// }\r\n\t\t},\r\n\r\n\t\tmethods: {\r\n\t\t\t...mapMutations(['regSendVoiceEvent']),\r\n\t\t\tonSendItem(e) {\r\n\t\t\t\t// console.log(e);\r\n\t\t\t\tif (e.sendType === 'fava' || e.sendType === 'card') {\r\n\t\t\t\t\t// console.log(e);\r\n\t\t\t\t\tthis.send(e.type, e.data, e.options)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdateHistory(isclear = true) {\r\n\t\t\t\tif (isclear) {\r\n\t\t\t\t\tthis.list = []\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.list = this.chat.getChatDetail()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonMessage(message) {\r\n\t\t\t\t// console.log('[[[[ada]]]]', message);\r\n\t\t\t\tif ((message.from_id === this.detail.id && message.chat_type === 'user') || (message.chat_type ===\r\n\t\t\t\t\t\t'group' && message.to_id === this.detail.id)) {\r\n\t\t\t\t\tif (message.isremove !== 1) {\r\n\t\t\t\t\t\tthis.list.push(message)\r\n\t\t\t\t\t\t// 置于底部\r\n\t\t\t\t\t\treturn this.pageToBottom()\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 撤回消息\r\n\t\t\t\t\tlet index = this.list.findIndex(item => item.id === message.id)\r\n\t\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\t\tthis.list[index].isremove = 1\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 打开聊天菜单\r\n\t\t\topenChatSet() {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '../chat-set/chat-set?params=' + JSON.stringify({\r\n\t\t\t\t\t\tid: this.detail.id,\r\n\t\t\t\t\t\tchat_type: this.detail.chat_type\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 录音相关\r\n\t\t\tvoiceTouchStart(e) {\r\n\t\t\t\tthis.RecordingStartY = e.changedTouches[0].screenY\r\n\t\t\t\tthis.isRecording = true\r\n\t\t\t\tthis.unRecord = false\r\n\t\t\t\t// 开始录音\r\n\t\t\t\tthis.RECORD.start({\r\n\t\t\t\t\tformat: \"mp3\",\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tvoiceTouchEnd() {\r\n\t\t\t\tthis.isRecording = false\r\n\r\n\t\t\t\t// 停止录音\r\n\t\t\t\tthis.RECORD.stop()\r\n\t\t\t},\r\n\t\t\t// 被打断\r\n\t\t\tvoiceTouchCancel() {\r\n\t\t\t\tthis.isRecording = false\r\n\t\t\t\tthis.unRecord = true\r\n\t\t\t\t// 停止录音\r\n\t\t\t\tthis.RECORD.stop()\r\n\t\t\t},\r\n\t\t\t// 主动取消\r\n\t\t\tvoiceTouchMove(e) {\r\n\t\t\t\tlet Y = Math.abs(e.changedTouches[0].screenY - this.RecordingStartY)\r\n\t\t\t\tthis.unRecord = (Y >= 80)\r\n\r\n\t\t\t},\r\n\t\t\t// 切换音频录制和文本输入\r\n\t\t\tchangeVoiceOrText() {\r\n\t\t\t\tthis.mode = this.mode !== 'audio' ? 'audio' : 'text'\r\n\t\t\t\tif (this.mode === 'audio') {\r\n\t\t\t\t\tuni.hideKeyboard()\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tpreviewImage(url) {\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tcurrent: url,\r\n\t\t\t\t\turls: this.imageList\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t__init() {\r\n\t\t\t\tlet total = 20\r\n\t\t\t\tlet page = Math.ceil(total / 8)\r\n\t\t\t\tvar arr = []\r\n\t\t\t\tfor (var i = 0; i < page; i++) {\r\n\t\t\t\t\tlet start = i * 8\r\n\t\t\t\t\tarr[i] = []\r\n\t\t\t\t\tfor (var j = 0; j < 8; j++) {\r\n\t\t\t\t\t\tvar no = start + j\r\n\t\t\t\t\t\tif ((no + 1) > total) {\r\n\t\t\t\t\t\t\tcontinue\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tarr[i].push({\r\n\t\t\t\t\t\t\tname: \"表情\" + no,\r\n\t\t\t\t\t\t\ticon: \"/static/images/emoticon/5497/\" + no + \".gif\",\r\n\t\t\t\t\t\t\tevent: 'sendEmoiticon'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.emoticonList = arr\r\n\t\t\t\t// 初始化会话列表\r\n\t\t\t\tthis.chat.initChatListItem({\r\n\t\t\t\t\tchat_type: this.detail.chat_type,\r\n\t\t\t\t\tto_id: this.detail.id,\r\n\t\t\t\t\tto_name: this.detail.name,\r\n\t\t\t\t\tto_avatar: this.detail.avatar,\r\n\t\t\t\t\tdata: this.detail.chat_type === 'user' ? '你们已经是好友可以开始聊天了' : '你已加入群聊，可以开始聊天了'\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tclickPage() {\r\n\t\t\r\n\t\t\t\tthis.mode = ''\r\n\t\t\t},\r\n\r\n\t\t\t// 打开扩展菜单 ｜｜或者 表情包\r\n\t\t\topenActionOrEmoticon(mode) {\r\n\t\t\t\tthis.mode = mode\r\n\t\t\t\t// this.KeyboardHeight = uni.upx2px(650)\r\n\t\t\t\tuni.hideKeyboard()\r\n\t\t\t\tthis.pageToBottom()\r\n\t\t\t},\r\n\t\t\t// 发送\r\n\t\t\tsend(type, data = '', options = {}) {\r\n\r\n\t\t\t\t// 组织数据格式\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\t\tcase 'text':\r\n\t\t\t\t\t\tdata = data || this.text\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t\tlet message = this.chat.formatSendData({\r\n\t\t\t\t\ttype,\r\n\t\t\t\t\tdata,\r\n\t\t\t\t\toptions\r\n\t\t\t\t})\r\n\t\t\t\t// console.log(options);\r\n\t\t\t\t// 渲染到页面\r\n\t\t\t\tlet index = this.list.length\r\n\t\t\t\tthis.list.push(message)\r\n\t\t\t\t// 监听上传进度\r\n\t\t\t\tlet onProgress = false\r\n\t\t\t\tif (message.type !== 'text' && message.type !== 'emoticon' && message.type !==\r\n\t\t\t\t\t'card' && !message.data.startsWith('http://wechatjhq')) {\r\n\t\t\t\t\tonProgress = (progress) => {\r\n\t\t\t\t\t\t//console.log('上传进度', progress);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 发送到服务端\r\n\t\t\t\tthis.chat.send(message, onProgress).then(res => {\r\n\t\t\t\t\t// 发送成功\r\n\t\t\t\t\tthis.list = this.chat.getChatDetail()\r\n\t\t\t\t\tthis.list[index].id = res.id\r\n\t\t\t\t\tthis.list[index].sendStatus = 'success'\r\n\t\t\t\t\t// console.log(res)\r\n\t\t\t\t}).catch(err => {\r\n\t\t\t\t\t//发送失败\r\n\t\t\t\t\tthis.list[index].sendStatus = 'fail'\r\n\t\t\t\t\t// console.log(err)\r\n\t\t\t\t})\r\n\t\t\t\t// 文字发送成功，清空输入框\r\n\t\t\t\tif (type === 'text') {\r\n\t\t\t\t\tthis.text = ''\r\n\t\t\t\t}\r\n\t\t\t\t// 置于底部\r\n\t\t\t\tthis.pageToBottom()\r\n\t\t\t\t// let pageToBottomTimer = setTimeout(() => {\r\n\t\t\t\t// \tthis.pageToBottom()\r\n\t\t\t\t// \tclearTimeout(pageToBottomTimer)\r\n\t\t\t\t// }, 200)\r\n\r\n\r\n\t\t\t},\r\n\t\t\t// 长按气泡事件\r\n\t\t\tlong({\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tindex\r\n\t\t\t}) {\r\n\t\t\t\t// 初始化 索引\r\n\t\t\t\tthis.propIndex = index\r\n\t\t\t\t// 组装菜单\r\n\t\t\t\tlet menus = [{\r\n\t\t\t\t\t\tname: '发送给朋友',\r\n\t\t\t\t\t\tevent: 'sendToChatItem'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: '收藏',\r\n\t\t\t\t\t\tevent: 'fava'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: '删除',\r\n\t\t\t\t\t\tevent: 'delete'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t// \tname: '多选',\r\n\t\t\t\t\t// \tevent: ''\r\n\t\t\t\t\t// },\r\n\r\n\t\t\t\t]\r\n\t\t\t\tlet item = this.list[this.propIndex]\r\n\t\t\t\tlet isSelf = this.user.id === item.from_id\r\n\t\t\t\tif (isSelf) {\r\n\t\t\t\t\tmenus.push({\r\n\r\n\t\t\t\t\t\tname: '撤回',\r\n\t\t\t\t\t\tevent: 'removeChatItem'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\t// #ifndef H5\r\n\t\t\t\tif (item.type === 'text') {\r\n\t\t\t\t\tmenus.unshift({\r\n\t\t\t\t\t\tname: '复制',\r\n\t\t\t\t\t\tevent: 'copy'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\t\t\t\tthis.menusList = menus\r\n\t\t\t\t// 显示扩展菜单\r\n\t\t\t\tthis.$refs.extend.show(x, y)\r\n\t\t\t},\r\n\t\t\t// 弹出层\r\n\t\t\tclickEvent(event) {\r\n\t\t\t\tlet item = this.list[this.propIndex]\r\n\t\t\t\tlet isSelf = this.user.id === item.from_id\r\n\t\t\t\tswitch (event) {\r\n\t\t\t\t\tcase \"removeChatItem\": //撤回\r\n\t\t\t\t\t\t// 拿到当前被操作的信息\r\n\t\t\t\t\t\tthis.chat.recall(item).then(res => {\r\n\t\t\t\t\t\t\titem.isremove = 1\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\tcase \"sendToChatItem\": //转发\r\n\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\turl: '../chat-list/chat-list?params=' + encodeURIComponent(JSON.stringify(item))\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\tcase \"copy\": //复制\r\n\t\t\t\t\t\tuni.setClipboardData({\r\n\t\t\t\t\t\t\tdata: item.data,\r\n\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: '复制成功',\r\n\t\t\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\t\t\tposition: \"bottom\"\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\tcase \"delete\": //删除\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: '确认删除？',\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tif (!res.confirm) return;\r\n\t\t\t\t\t\t\t\tthis.chat.deleteChatDetailIten(item, isSelf)\r\n\t\t\t\t\t\t\t\tthis.list.splice(this.propIndex, 1)\r\n\r\n\t\t\t\t\t\t\t\t// 删除最后一条消息\r\n\t\t\t\t\t\t\t\tif (this.list.length === this.propIndex) {\r\n\t\t\t\t\t\t\t\t\t// console.log(this.list[this.propIndex - 1]);\r\n\t\t\t\t\t\t\t\t\tthis.chat.updateChatItem({\r\n\t\t\t\t\t\t\t\t\t\tid: this.detail.id,\r\n\t\t\t\t\t\t\t\t\t\tchat_type: this.detail.chat_type\r\n\t\t\t\t\t\t\t\t\t}, (v) => {\r\n\t\t\t\t\t\t\t\t\t\tlet o = this.list[this.propIndex - 1]\r\n\t\t\t\t\t\t\t\t\t\tlet data = ''\r\n\t\t\t\t\t\t\t\t\t\tlet create_time = ''\r\n\t\t\t\t\t\t\t\t\t\tv.update_time = o.create_time\r\n\t\t\t\t\t\t\t\t\t\tif (o.isremove !== 1) {\r\n\t\t\t\t\t\t\t\t\t\t\tdata = this.chat.formatChatItemData(o, isSelf)\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tdata = isSelf ? '你撤回了一条消息' : `\"${o.from_name}\" 撤回了一条消息`\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tv.data = data\r\n\t\t\t\t\t\t\t\t\t\treturn v\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\tcase \"fava\": //加入收藏\r\n\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: \"是否加入收藏？\",\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\t\t$H.post('/fava/create', {\r\n\t\t\t\t\t\t\t\t\t\ttype: item.type,\r\n\t\t\t\t\t\t\t\t\t\tdata: item.data,\r\n\t\t\t\t\t\t\t\t\t\toptions: JSON.stringify(item.options)\r\n\t\t\t\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: '加入收藏成功',\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t\tthis.$refs.extend.hide()\r\n\t\t\t},\r\n\t\t\t// 回到底部\r\n\r\n\t\t\tpageToBottom() {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t// #ifdef APP-PLUS-NVUE\r\n\r\n\t\t\t\t\tlet chatItem = this.$refs.chatItem\r\n\t\t\t\t\tif (chatItem) {\r\n\t\t\t\t\t\tlet lastItem = chatItem.length > 0 ? chatItem.length - 1 : 0\r\n\t\t\t\t\t\tif (chatItem[lastItem]) {\r\n\t\t\t\t\t\t\tdom.scrollToElement(chatItem[lastItem], {})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\t// #ifndef APP-PLUS-NVUE\r\n\t\t\t\t\tlet lastIndex = this.list.length - 1\r\n\t\t\t\t\tthis.scrollintoView = 'chatItem_' + lastIndex\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t}, 300)\r\n\r\n\t\t\t},\r\n\t\t\t// 拓展菜单点击判断\r\n\t\t\tactionEvent(e) {\r\n\t\t\t\tswitch (e.event) {\r\n\t\t\t\t\t// 相册\r\n\t\t\t\t\tcase \"uploadImage\":\r\n\t\t\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\t\t\tcount: 9,\r\n\t\t\t\t\t\t\tsourceType: ['album'],\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t// 发送服务器\r\n\t\t\t\t\t\t\t\t// 渲染到页面\r\n\t\t\t\t\t\t\t\tres.tempFilePaths.forEach((item) => {\r\n\t\t\t\t\t\t\t\t\tthis.send('image', item)\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\t\t//表情包\r\n\t\t\t\t\tcase \"sendEmoiticon\":\r\n\r\n\t\t\t\t\t\tthis.send('emoticon', e.icon)\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\t\t// 视频\r\n\t\t\t\t\tcase \"uploadVideo\":\r\n\t\t\t\t\t\tuni.chooseVideo({\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t// 发送服务器\r\n\t\t\t\t\t\t\t\t// 渲染到页面\r\n\r\n\t\t\t\t\t\t\t\tthis.send('video', res.tempFilePath)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\tcase \"openFava\": //发送收藏\r\n\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\turl: '../../my/fava/fava?type=send'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\tcase \"sendCard\": //发送名片\r\n\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\turl: '../../mail/mail/mail?type=sendCard&limit=1',\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak\r\n\r\n\t\t\t\t}\r\n\t\t\t\t// this.$refs.extend.hide()\r\n\t\t\t},\n\t\t\tfocus(e){\n\t\t\t\tthis.mode='text'\n\t\t\t\tthis.isfocus=true\n\t\t\t\tthis.KeyboardHeight=e.detail.height\n\t\t\t\tthis.pageToBottom()\n\t\t\t},\n\t\t\tblur(e){\n\t\t\t\tthis.isfocus=false\n\t\t\t\tthis.KeyboardHeight=0\n\t\t\t}\r\n\r\n\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t...mapState({\n\t\t\t\ttotalNoreadnum:state=>state.user.totalNoreadnum,\r\n\t\t\t\tchatList: state => state.user.chatList,\r\n\t\t\t\tRECORD: state => state.audio.RECORD,\r\n\t\t\t\tRecordTime: state => state.audio.RecordTime,\r\n\t\t\t\tchat: state => state.user.chat,\r\n\t\t\t\tuser: state => state.user.user,\n\t\t\t\t// KeyboardH:state=>state.common.keyboardHeight\r\n\t\t\t}),\r\n\t\t\t// 当前会话配置信息\r\n\t\t\tcurrentChatItem() {\r\n\t\t\t\tlet index = this.chatList.findIndex(item => item.id === this.detail.id && item.chat_type === this.detail\r\n\t\t\t\t\t.chat_type)\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\treturn this.chatList[index]\r\n\t\t\t\t}\r\n\t\t\t\treturn {}\r\n\t\t\t},\r\n\t\t\t// 所有信息图片地址\r\n\t\t\timageList() {\r\n\t\t\t\tlet arr = []\r\n\t\t\t\tthis.list.forEach((item) => {\r\n\t\t\t\t\tif (item.type === 'image' || item.type === 'emoticon') {\r\n\t\t\t\t\t\tarr.push(item.data)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\treturn arr\r\n\t\t\t},\r\n\t\t\t// 动态获取菜单高度\r\n\t\t\tgetMenusHeight() {\r\n\t\t\t\tlet H = 100\r\n\t\t\t\treturn this.menusList.length * H\r\n\t\t\t},\r\n\t\t\t// 获取菜单样式\r\n\t\t\tgetMenusStyle() {\r\n\t\t\t\treturn `height:${this.getMenusHeight}rpx`\r\n\t\t\t},\r\n\t\t\t// 判断是否操作本人信息\r\n\t\t\tisdeSelf() {\r\n\t\t\t\tlet id = 1\r\n\t\t\t\tlet user_id = this.propIndex > -1 ? this.list[this.propIndex].user_id : 0\r\n\t\t\t\treturn user_id === id\r\n\t\t\t},\r\n\t\t\t// 聊天区域bottom\r\n\t\t\tchatBodyBottom() {\n\t\t\t\tlet h = this.mode==='emoticon'||this.mode==='action'?  uni.upx2px(755): uni.upx2px(105)\n\t\t\t\tif(this.isfocus){\n\t\t\t\t\th = this.KeyboardHeight+uni.upx2px(105)\n\t\t\t\t}\r\n\t\t\t\treturn `top:${this.navBarHeight}px; bottom:${h}px;`\r\n\t\t\t},\r\n\t\t\t// 动态获取蒙版位置\r\n\t\t\tMaskBottom() {\n\t\t\t\tlet h = this.mode==='emoticon'||this.mode==='action'?  uni.upx2px(755): uni.upx2px(105)\n\t\t\t\tif(this.isfocus){\n\t\t\t\t\th = this.KeyboardHeight+uni.upx2px(105)\n\t\t\t\t}\r\n\t\t\t\treturn h\r\n\t\t\t},\r\n\t\t\t// 获取操作表情列表\r\n\t\t\temoticonOrActionList() {\r\n\t\t\t\treturn (this.mode === 'emoticon' || this.mode === 'action') ? this[this.mode + 'List'] : []\r\n\r\n\t\t\t},\n\t\t\t\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\n","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1655376689777\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}